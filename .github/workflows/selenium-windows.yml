name: Selenium tests (Windows)

on:
  push:
    branches: ["main"]
  pull_request:
    branches: ["main"]
  workflow_dispatch:

permissions:
  contents: read

jobs:
  selenium-windows:
    runs-on: windows-latest

    steps:
    - uses: actions/checkout@v4

    - name: Install Chromium
      shell: pwsh
      run: choco install chromium --no-progress --yes

    - name: Add Chromium to PATH
      shell: pwsh
      run: echo "C:\Program Files (x86)\Chromium\Application" | Out-File -FilePath $env:GITHUB_PATH -Encoding utf8 -Append

    - uses: actions/setup-python@v4
      with:
        python-version: "3.11"

    - name: Create venv & install deps
      shell: pwsh
      run: |
        python -m venv venv
        ./venv/Scripts/pip install --upgrade pip
        ./venv/Scripts/pip install selenium webdriver-manager pytest pytest-html allure-pytest pytest-xdist pytest-rerunfailures

    - name: Run Selenium tests (headless)
      shell: pwsh
      working-directory: ./selenium-tests
      run: |
        ../venv/Scripts/python -m pytest tests --headless -q
